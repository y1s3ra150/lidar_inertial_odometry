# LIO Configuration for Livox Mid-360 LiDAR
# Author: Seungwon Choi
# Date: 2025-11-19

# Dataset paths (will be overridden by command line argument)
dataset:
  lidar_folder: "lidar"
  imu_csv: "imu_data.csv"
  lidar_timestamps: "lidar_timestamps.txt"


# Extrinsics: LiDAR to IMU transformation
# T_il: Transformation from IMU frame to LiDAR frame
# p_l = R_il * p_i + t_il
extrinsics:
  # Rotation matrix (3x3) - row-major
  # R3LIVE/Avia dataset: sensors are aligned (identity matrix)
  R_il: [
    [1.0, 0.0, 0.0],
    [0.0, 1.0, 0.0],
    [0.0, 0.0, 1.0]
  ]
  # Translation vector (3x1) [meters]
  t_il: [-0.011, -0.02329, 0.04412]


# Estimator parameters (indoor: 0.5 / 5 / 1.0, outdoor: 1.0 / 3 / 2.0)
estimator:
  enable_undistortion: true
  scan_duration: 0.1          # LiDAR scan duration in seconds (100ms for Livox Avia)
  init_imu_samples: 100       # Number of IMU samples for initialization
  voxel_size: 0.5       # Voxel size in meters for VoxelMap
  max_iterations: 4       # Maximum Gauss-Newton iterations
  convergence_threshold: 0.001 # Convergence threshold for optimization

  # Surfel filtering
  map_planarity_threshold: 0.1    # Planarity threshold (sigma_min/sigma_max, smaller = stricter)

  # Stride-based downsampling (simple and efficient)
  stride: 4                     # Keep every Nth point (1 = no skip, 2 = half, 4 = quarter)
  stride_then_voxel: true       # Apply voxel downsample after stride (recommended)

  # Local map parameters
  min_distance: 3.0             # Minimum distance for lidar filtering (meters)
  max_distance: 100.0           # Maximum distance for lidar filtering (meters)
  map_box_multiplier: 2.0       # Map box size = max_distance × multiplier (e.g., 100m × 2 = 200m box)
                                # Map is re-centered when sensor moves > max_distance/multiplier from center
  voxel_hierarchy_factor: 3      # L1 voxel factor: L1 = factor × L0 (e.g., 3 = 3×3×3, 5 = 5×5×5, 7 = 7×7×7)


# Viewer parameters
viewer:
  window_width: 1920
  window_height: 1080

# Playback parameters
playback:
  playback_speed: 100.0          # Playback speed multiplier



imu:
  gyr_cov: 1e-1              # Gyroscope noise covariance [rad/s]
  acc_cov: 1e-1               # Accelerometer noise covariance [m/s^2]
  b_gyr_cov: 1e-6         # Gyroscope bias covariance [rad/s]
  b_acc_cov: 1e-4          # Accelerometer bias covariance [m/s^2]
  gravity: [0.0, 0.0, -9.81]  # Gravity vector [m/s^2]
